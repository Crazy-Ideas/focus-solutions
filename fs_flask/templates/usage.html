{% extends "base.html" %}

{% block app_content %}
    <div class="row justify-content-center">
        <div class="col-lg-4">
            <ul class="list-group text-center">
                <li class="list-group-item list-group-item-secondary">
                    <strong>{{ form.hotel.name }}</strong>
                </li>
            </ul>
        </div>
        <div class="col-lg-4">
            <ul class="list-group text-center">
                <li class="list-group-item list-group-item-secondary">
                    <strong>{{ form.formatted_date }}</strong> - <strong>{{ form.timing }}</strong>
                </li>
            </ul>
        </div>
        <div class="col-lg-4">
            <ul class="list-group text-center">
                <li class="list-group-item list-group-item">
                    <a type="button" class="btn btn-success text-white" data-toggle="modal" data-target="#usage-modal"
                       data-type="{{ form.CREATE }}" data-title="New Event" data-timing="{{ form.timing }}">
                        <span class="oi oi-plus"></span>
                    </a>
                    <a type="button" class="btn btn-danger text-white {{ form.display_no_event }}" id="no-event-button">
                        <span class="oi oi-ban"></span>
                    </a>
                    <a class="btn btn-primary {{ form.display_previous }}" href="{{ form.link_previous }}">
                        <span class="oi oi-arrow-thick-left"></span>
                    </a>
                    <a class="btn btn-primary" href="#">
                        <span class="oi oi-calendar"></span>
                    </a>
                    <a class="btn btn-primary {{ form.display_next }}" href="{{ form.link_next }}">
                        <span class="oi oi-arrow-thick-right"></span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
    {% if form.usages %}
        <br>
        <table id="usage_list" class="table table-bordered table-hover ">
            <thead class="thead-dark">
            <tr>
                <th class="" scope="col">Client</th>
                <th class="text-center d-none d-md-table-cell" scope="col">Meal</th>
                <th class="text-center d-none d-md-table-cell" scope="col">Type</th>
                <th class="text-center d-none d-md-table-cell" scope="col">Ballroom</th>
                <th class="d-none d-md-table-cell" scope="col">Event</th>
                <th class="text-center" scope="col">
                    <span class="oi oi-pencil"></span>
                </th>
                <th class="text-center" scope="col">
                    <span class="oi oi-trash"></span>
                </th>
            </tr>
            </thead>
            <tbody>
            {% for usage in form.usages %}
                <tr>
                    <td class="">{{ usage.company }}</td>
                    <td class="text-center d-none d-md-table-cell">{{ usage.formatted_meal }}</td>
                    <td class="text-center d-none d-md-table-cell">{{ usage.event_type }}</td>
                    <td class="text-center d-none d-md-table-cell">{{ usage.formatted_ballroom }}</td>
                    <td class="d-none d-md-table-cell">{{ usage.event_description }}</td>
                    <td class="text-center">
                        <a class="btn btn-warning">
                            <span class="oi oi-pencil"></span>
                        </a>
                    </td>
                    <td class="text-center text-white">
                        <a class="btn btn-danger">
                            <span class="oi oi-trash"></span>
                        </a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="row">
            <div class="col text-center">
                <strong>No events recorded</strong>
            </div>
        </div>
    {% endif %}
    <div class="modal fade" id="usage-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Placeholder Title</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body justify-content-center">
                    <form class="form" method="POST" id="usage-form">
                        {{ form.csrf_token() }}
                        {{ form.form_type() }}
                        {{ form.usage_id() }}
                        <div id="edit-usage">
                            {{ form_group_no_error(form.client) }}
                            <div id="morning-meal">
                                {{ check_box(form.breakfast) }}
                                {{ check_box(form.lunch) }}
                            </div>
                            <div id="evening-meal">
                                {{ check_box(form.hi_tea) }}
                                {{ check_box(form.dinner) }}
                            </div>
                            {{ check_box(form.no_meal) }}
                            {{ form_group_no_error(form.event_type) }}
                            {{ form_group_no_error(form.ballrooms) }}
                            {{ form_group_no_error(form.event_description) }}
                        </div>
                        <div id="comment">
                            Placeholder comment
                        </div>
                    </form>
                </div>
                <div class="modal-footer justify-content-center d-flex">
                    <button type="button" class="btn" id="save-button">Placeholder</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script>
        $(document).ready(function () {
            $('#usage_list').DataTable();
        });
        $("#save-button").on("click", function () {
            document.forms["usage-form"].submit();
        });
        $("#usage-modal").on("show.bs.modal", function (event) {
            let form_type = $(event.relatedTarget).data("type");
            let title = $(event.relatedTarget).data("title");
            // let usage_id = $(event.relatedTarget).data("id");
            let timing = $(event.relatedTarget).data("timing");
            $(this).find(".modal-title").text(title);
            $(this).find("#form_type").val(form_type);
            if (form_type === "{{ form.CREATE }}") {
                $(this).find("#save-button").addClass("btn-success").removeClass("btn-danger").html("Create");
                $(this).find("#edit-usage").show();
                $(this).find("#comment").hide();
                $(this).find("#client").val("");
                $(this).find("#breakfast").prop("checked", false);
                $(this).find("#lunch").prop("checked", false);
                $(this).find("#hi_tea").prop("checked", false);
                $(this).find("#dinner").prop("checked", false);
                $(this).find("#no_meal").prop("checked", true);
                $(this).find("#event_type").val($(this).find("#event_type option:first").val());
                $(this).find("#ballrooms").val(null).trigger("change");
                $(this).find("#event_description").val("")
                if (timing === "{{ config.MORNING }}") {
                    $(this).find("#morning-meal").show()
                    $(this).find("#evening-meal").hide()
                } else {
                    $(this).find("#evening-meal").show()
                    $(this).find("#morning-meal").hide()
                }
            }
        });
        $("#usage-form").on("change", ":checkbox", function () {
            if (["breakfast", "lunch", "hi_tea", "dinner"].includes(this.id) && this.checked) {
                $("#no_meal").prop("checked", false);
            }
            if (this.id === "no_meal" && this.checked) {
                $("#breakfast").prop("checked", false);
                $("#lunch").prop("checked", false);
                $("#hi_tea").prop("checked", false);
                $("#dinner").prop("checked", false);
            }
        });
    </script>
{% endblock %}